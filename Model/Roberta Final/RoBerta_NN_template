{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"name":"RoBerta_NN_template","provenance":[],"collapsed_sections":[]},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"accelerator":"GPU","widgets":{"application/vnd.jupyter.widget-state+json":{"92f485d689a54f32a67277363bd41b8d":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_7b7ac68a999c4724b8a2a4f3a7624846","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_449c108e50584aaa803326fe15da8eb8","IPY_MODEL_d55bf49125cd40069416f088d9fd0500","IPY_MODEL_61fed412fdaf4b3faff81dc270489e82"]}},"7b7ac68a999c4724b8a2a4f3a7624846":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"449c108e50584aaa803326fe15da8eb8":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_6fe0c2925d49474e85ce997023dfb6aa","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"Downloading: 100%","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_643a8749580c41609823e31618e27f14"}},"d55bf49125cd40069416f088d9fd0500":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_view_name":"ProgressView","style":"IPY_MODEL_1ae1a0a09be04039acc70988aa00d42e","_dom_classes":[],"description":"","_model_name":"FloatProgressModel","bar_style":"success","max":898823,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":898823,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_f9e8d3441ece4e088dc1f1b3f644bb5d"}},"61fed412fdaf4b3faff81dc270489e82":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_daa855e844054270947ce5bd708e8f29","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 899k/899k [00:00&lt;00:00, 3.65MB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_756e025b13b04015b89eef646ff00547"}},"6fe0c2925d49474e85ce997023dfb6aa":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"643a8749580c41609823e31618e27f14":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"1ae1a0a09be04039acc70988aa00d42e":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"f9e8d3441ece4e088dc1f1b3f644bb5d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"daa855e844054270947ce5bd708e8f29":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"756e025b13b04015b89eef646ff00547":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"91e31d2256734d02be240743664f7781":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_bb800195017345f4a1d78b3865ad67c8","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_692ccbaf27444d908177a723047bdb14","IPY_MODEL_46a0319453cb4d1f90398fedc12bd206","IPY_MODEL_b19e82a2f6554fcd9fb46f2e224be009"]}},"bb800195017345f4a1d78b3865ad67c8":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"692ccbaf27444d908177a723047bdb14":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_12d23a326f424597b00d8136511d944a","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"Downloading: 100%","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_cdea212730f24996bab5d83c09d772f2"}},"46a0319453cb4d1f90398fedc12bd206":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_view_name":"ProgressView","style":"IPY_MODEL_9f87e9bff001439f8be84e0fca076c87","_dom_classes":[],"description":"","_model_name":"FloatProgressModel","bar_style":"success","max":456318,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":456318,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_d15470c7627946a8a19d9ef4177f6fca"}},"b19e82a2f6554fcd9fb46f2e224be009":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_5fbbd99832104a86b2829cf75644659d","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 456k/456k [00:00&lt;00:00, 978kB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_7104ac69b1b44268ad65673ea7d54a69"}},"12d23a326f424597b00d8136511d944a":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"cdea212730f24996bab5d83c09d772f2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"9f87e9bff001439f8be84e0fca076c87":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"d15470c7627946a8a19d9ef4177f6fca":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"5fbbd99832104a86b2829cf75644659d":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"7104ac69b1b44268ad65673ea7d54a69":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"18c516bcdf9b41a397d6e4e2b5cfee8f":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_9c3d229cb76f4f3ca509aa3dde862fc6","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_5ba6e8ce844b4332b96dab214d80cfa4","IPY_MODEL_0fdf544c202047de981acf72dcc48718","IPY_MODEL_31ab7c2d44864da995f29978d6c0cf5a"]}},"9c3d229cb76f4f3ca509aa3dde862fc6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"5ba6e8ce844b4332b96dab214d80cfa4":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_d7e8c3a6049a4e419f42f33d2d3d5f98","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"Downloading: 100%","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_1fe5b3eab12742d9921943af0f290a76"}},"0fdf544c202047de981acf72dcc48718":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_view_name":"ProgressView","style":"IPY_MODEL_e7c22bf60cda49e482cffc5067b2813f","_dom_classes":[],"description":"","_model_name":"FloatProgressModel","bar_style":"success","max":1355863,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":1355863,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_1008ec0c6e5d487f90bf219887ea7ed8"}},"31ab7c2d44864da995f29978d6c0cf5a":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_3e064070a7524220bdc7f23b716762ca","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 1.36M/1.36M [00:00&lt;00:00, 1.49MB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_0d17c4916f29474f931024216ebfa368"}},"d7e8c3a6049a4e419f42f33d2d3d5f98":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"1fe5b3eab12742d9921943af0f290a76":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"e7c22bf60cda49e482cffc5067b2813f":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"1008ec0c6e5d487f90bf219887ea7ed8":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"3e064070a7524220bdc7f23b716762ca":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"0d17c4916f29474f931024216ebfa368":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"3a3257d9f49944dfad978b6962dd9b20":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_1a5319316a2f411ea920fc04aa6605f0","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_a1ea84ad97d54d72992c79adfedaa009","IPY_MODEL_9714fab78c704c98afc8f688af031cce","IPY_MODEL_80bd1d9b5129488cabe9c4e290d62ac6"]}},"1a5319316a2f411ea920fc04aa6605f0":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"a1ea84ad97d54d72992c79adfedaa009":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_f7a4d9739b09445992c6e8a182584081","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"Downloading: 100%","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_e0a080d5e13b4f97bf7ac18bebeba08d"}},"9714fab78c704c98afc8f688af031cce":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_view_name":"ProgressView","style":"IPY_MODEL_7b371e84218043f1b7c72c21f7d6b7ee","_dom_classes":[],"description":"","_model_name":"FloatProgressModel","bar_style":"success","max":481,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":481,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_7da5b43ddd8c4ab2803dacf80c8ed978"}},"80bd1d9b5129488cabe9c4e290d62ac6":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_03f0e29f66d24b00adc2f038df15891e","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 481/481 [00:00&lt;00:00, 6.61kB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_68953f90bbe14285a00379e145c33f54"}},"f7a4d9739b09445992c6e8a182584081":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"e0a080d5e13b4f97bf7ac18bebeba08d":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"7b371e84218043f1b7c72c21f7d6b7ee":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"7da5b43ddd8c4ab2803dacf80c8ed978":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"03f0e29f66d24b00adc2f038df15891e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"68953f90bbe14285a00379e145c33f54":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"78a5d4635ab340b38ce8918c79568bcc":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_view_name":"HBoxView","_dom_classes":[],"_model_name":"HBoxModel","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.5.0","box_style":"","layout":"IPY_MODEL_36f7925836514c56b42837136b2a9e69","_model_module":"@jupyter-widgets/controls","children":["IPY_MODEL_97f1f68d4d9a481a8570250efcfae485","IPY_MODEL_58759061d8534e2ab2a6ca8bad3e10ec","IPY_MODEL_d8922b85d67946d2a1a847fb7f39b632"]}},"36f7925836514c56b42837136b2a9e69":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"97f1f68d4d9a481a8570250efcfae485":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_423166a905b74a98a00b22384fb76412","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":"Downloading: 100%","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_838ff370257a49a9aa0a1634c9ef7d7b"}},"58759061d8534e2ab2a6ca8bad3e10ec":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_view_name":"ProgressView","style":"IPY_MODEL_7e3562b0ff974250b46250208248447d","_dom_classes":[],"description":"","_model_name":"FloatProgressModel","bar_style":"success","max":501200538,"_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":501200538,"_view_count":null,"_view_module_version":"1.5.0","orientation":"horizontal","min":0,"description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_18a7e0142abb46bda8df6aac01d148c5"}},"d8922b85d67946d2a1a847fb7f39b632":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_view_name":"HTMLView","style":"IPY_MODEL_5f658c1898bb479786227d3667a47f68","_dom_classes":[],"description":"","_model_name":"HTMLModel","placeholder":"​","_view_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","value":" 501M/501M [00:17&lt;00:00, 29.9MB/s]","_view_count":null,"_view_module_version":"1.5.0","description_tooltip":null,"_model_module":"@jupyter-widgets/controls","layout":"IPY_MODEL_60d8d574da0a423d8a759411b4f86f34"}},"423166a905b74a98a00b22384fb76412":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"838ff370257a49a9aa0a1634c9ef7d7b":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"7e3562b0ff974250b46250208248447d":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"ProgressStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","bar_color":null,"_model_module":"@jupyter-widgets/controls"}},"18a7e0142abb46bda8df6aac01d148c5":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}},"5f658c1898bb479786227d3667a47f68":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_view_name":"StyleView","_model_name":"DescriptionStyleModel","description_width":"","_view_module":"@jupyter-widgets/base","_model_module_version":"1.5.0","_view_count":null,"_view_module_version":"1.2.0","_model_module":"@jupyter-widgets/controls"}},"60d8d574da0a423d8a759411b4f86f34":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_view_name":"LayoutView","grid_template_rows":null,"right":null,"justify_content":null,"_view_module":"@jupyter-widgets/base","overflow":null,"_model_module_version":"1.2.0","_view_count":null,"flex_flow":null,"width":null,"min_width":null,"border":null,"align_items":null,"bottom":null,"_model_module":"@jupyter-widgets/base","top":null,"grid_column":null,"overflow_y":null,"overflow_x":null,"grid_auto_flow":null,"grid_area":null,"grid_template_columns":null,"flex":null,"_model_name":"LayoutModel","justify_items":null,"grid_row":null,"max_height":null,"align_content":null,"visibility":null,"align_self":null,"height":null,"min_height":null,"padding":null,"grid_auto_rows":null,"grid_gap":null,"max_width":null,"order":null,"_view_module_version":"1.2.0","grid_template_areas":null,"object_position":null,"object_fit":null,"grid_auto_columns":null,"margin":null,"display":null,"left":null}}}}},"cells":[{"cell_type":"code","metadata":{"id":"JXKj04qfZWOa","executionInfo":{"status":"ok","timestamp":1630903663613,"user_tz":420,"elapsed":216,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["# This module contains the basic template with the functions definitions to be copied into\n","# utils.py file. IN case of edit \n","# 1. Change here first\n","# 2 . Make sure it runs \n","# 3. "],"execution_count":1,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"-pp3_2ZLq6NS","executionInfo":{"status":"ok","timestamp":1630903680230,"user_tz":420,"elapsed":16620,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"b066227d-3a65-4ade-cd9b-91b605bbb09f"},"source":["from datetime import datetime\n","import tensorflow as tf\n","import pandas as pd\n","import numpy as np\n","import re, string\n","import time\n","import random\n","import gc\n","import os, sys\n","import json\n","from copy import deepcopy\n","\n","#####\n","# !pip install gdown\n","!pip install transformers\n","pd.options.display.max_colwidth = 500\n","#####\n","\n","import torch\n","##### SET SEEED ######\n","# seed = 123\n","# random.seed(seed)\n","# os.environ['PYTHONHASHSEED'] = str(seed)\n","# np.random.seed(seed)\n","# torch.manual_seed(seed)\n","# torch.cuda.manual_seed(seed)\n","# torch.backends.cudnn.deterministic = True\n","# torch.backends.cudnn.benchmark = True\n","######################\n","\n","# !pip install simpletransfomers\n","\n","from transformers import BertForSequenceClassification, AdamW , BertConfig, BertModel\n","from transformers import RobertaConfig, RobertaModel, RobertaTokenizer, RobertaForSequenceClassification\n","from transformers import get_linear_schedule_with_warmup\n","from transformers import LineByLineTextDataset\n","\n","from torch.nn import LSTM, Dropout, Linear, BCELoss, CrossEntropyLoss, Softmax, ReLU, LeakyReLU, Tanh\n","from torch.nn.functional import softmax, relu\n","from torch.nn.utils.rnn import pack_padded_sequence\n","from torch.utils.data.dataset import Subset\n","\n","\n","\n","\n","from sklearn.model_selection import KFold\n","from sklearn.metrics import accuracy_score, precision_score, confusion_matrix\n","\n","%load_ext autoreload \n","%autoreload 2"],"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting transformers\n","  Downloading transformers-4.10.0-py3-none-any.whl (2.8 MB)\n","\u001b[K     |████████████████████████████████| 2.8 MB 6.2 MB/s \n","\u001b[?25hRequirement already satisfied: importlib-metadata in /usr/local/lib/python3.7/dist-packages (from transformers) (4.6.4)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.7/dist-packages (from transformers) (3.0.12)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.7/dist-packages (from transformers) (2019.12.20)\n","Requirement already satisfied: numpy>=1.17 in /usr/local/lib/python3.7/dist-packages (from transformers) (1.19.5)\n","Requirement already satisfied: packaging in /usr/local/lib/python3.7/dist-packages (from transformers) (21.0)\n","Collecting tokenizers<0.11,>=0.10.1\n","  Downloading tokenizers-0.10.3-cp37-cp37m-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_12_x86_64.manylinux2010_x86_64.whl (3.3 MB)\n","\u001b[K     |████████████████████████████████| 3.3 MB 33.8 MB/s \n","\u001b[?25hRequirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from transformers) (2.23.0)\n","Collecting pyyaml>=5.1\n","  Downloading PyYAML-5.4.1-cp37-cp37m-manylinux1_x86_64.whl (636 kB)\n","\u001b[K     |████████████████████████████████| 636 kB 30.0 MB/s \n","\u001b[?25hCollecting sacremoses\n","  Downloading sacremoses-0.0.45-py3-none-any.whl (895 kB)\n","\u001b[K     |████████████████████████████████| 895 kB 34.1 MB/s \n","\u001b[?25hRequirement already satisfied: tqdm>=4.27 in /usr/local/lib/python3.7/dist-packages (from transformers) (4.62.0)\n","Collecting huggingface-hub>=0.0.12\n","  Downloading huggingface_hub-0.0.16-py3-none-any.whl (50 kB)\n","\u001b[K     |████████████████████████████████| 50 kB 4.3 MB/s \n","\u001b[?25hRequirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from huggingface-hub>=0.0.12->transformers) (3.7.4.3)\n","Requirement already satisfied: pyparsing>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging->transformers) (2.4.7)\n","Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata->transformers) (3.5.0)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->transformers) (1.24.3)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->transformers) (2.10)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->transformers) (2021.5.30)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->transformers) (3.0.4)\n","Requirement already satisfied: six in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers) (1.15.0)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers) (1.0.1)\n","Requirement already satisfied: click in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers) (7.1.2)\n","Installing collected packages: tokenizers, sacremoses, pyyaml, huggingface-hub, transformers\n","  Attempting uninstall: pyyaml\n","    Found existing installation: PyYAML 3.13\n","    Uninstalling PyYAML-3.13:\n","      Successfully uninstalled PyYAML-3.13\n","Successfully installed huggingface-hub-0.0.16 pyyaml-5.4.1 sacremoses-0.0.45 tokenizers-0.10.3 transformers-4.10.0\n"]}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"MzEvkGACWMqX","executionInfo":{"status":"ok","timestamp":1630903705959,"user_tz":420,"elapsed":25746,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"5eb07ac9-de6d-4368-d1fb-6471874a8c94"},"source":["from google.colab import drive\n","drive.mount('/content/drive')"],"execution_count":3,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"DUYifLXWu1D0","executionInfo":{"status":"ok","timestamp":1630903706868,"user_tz":420,"elapsed":914,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"7df0b3a4-cb1c-4b10-b4ae-04e46953275e"},"source":["!ls \"/content/drive/MyDrive/Colab Notebooks/Bert Hate Speech/Model\""],"execution_count":4,"outputs":[{"output_type":"stream","name":"stdout","text":["'Bert Models'   models.py   __pycache__   RoBerta  'Roberta Final'\n"]}]},{"cell_type":"code","metadata":{"id":"f6srHxsX4FhM","executionInfo":{"status":"ok","timestamp":1630903706868,"user_tz":420,"elapsed":4,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["PATH_PREFIX = '/content/drive/MyDrive/Colab Notebooks/Bert Hate Speech'"],"execution_count":5,"outputs":[]},{"cell_type":"code","metadata":{"id":"C8keHP8s6Fj4","executionInfo":{"status":"ok","timestamp":1630903710475,"user_tz":420,"elapsed":3609,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["sys.path.append('/content/drive/MyDrive/Colab Notebooks/Bert Hate Speech/utils')\n","sys.path.append('/content/drive/MyDrive/Colab Notebooks/Bert Hate Speech/Model')\n","\n","from models import *\n","from text_processing import *"],"execution_count":6,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"mFayi-JvrDHx","executionInfo":{"status":"ok","timestamp":1630903713494,"user_tz":420,"elapsed":3033,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"c22f0fb3-109e-48ea-f6de-abf7ea356cce"},"source":["# Enable GPU before proceeding\n","device_name = tf.test.gpu_device_name()\n","print(\"Device found:\", device_name)"],"execution_count":7,"outputs":[{"output_type":"stream","name":"stdout","text":["Device found: /device:GPU:0\n"]}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"LLkb-vZhryC-","executionInfo":{"status":"ok","timestamp":1630903713494,"user_tz":420,"elapsed":10,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"3400c775-c687-4234-f2f8-74d49cfff912"},"source":["# Test if CUDA is available, use it\n","if torch.cuda.is_available():\n","    device = torch.device('cuda')\n","else:\n","    device = torch.device('cpu')\n","print(\"Using CUDA Device:\", torch.cuda.get_device_name())"],"execution_count":8,"outputs":[{"output_type":"stream","name":"stdout","text":["Using CUDA Device: Tesla K80\n"]}]},{"cell_type":"markdown","metadata":{"id":"Jgmig-gyT5_U"},"source":["# DOWNLOAD AND PREPROCESS DATA"]},{"cell_type":"code","metadata":{"id":"CHNrlwxNPOMu","executionInfo":{"status":"ok","timestamp":1630903713645,"user_tz":420,"elapsed":156,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["def load_data(data_path:str, dtype_dict:dict, break_point:int=2400, ):\n","    \"\"\"\n","    Return the train and test data split at the specified index\n","    param data_path: str of file directory AND name\n","    param dtype_dict: dict of the datatype to read the data\n","    param break_point: int of the index to break\n","    \"\"\"\n","    df = pd.read_csv(data_path, dtype=dtype_dict)\n","    train  = df[:break_point]\n","    test   = df[break_point:]\n","\n","    for k in dtype_dict:\n","        if k != 'tweetid':\n","            print(train.groupby(k)[k].count())\n","\n","    return train,test"],"execution_count":9,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"TIGMfizwRlrM","executionInfo":{"status":"ok","timestamp":1630903714138,"user_tz":420,"elapsed":495,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"da6afff0-e57d-4624-c3f2-874a8259ddbd"},"source":["train_dt, test_dt = load_data(PATH_PREFIX + '/Data/HER_final_data.csv', \n","                   dtype_dict={'tweetid':str, 'label':int, 'target':int, 'aggr':int})"],"execution_count":10,"outputs":[{"output_type":"stream","name":"stdout","text":["label\n","0    1894\n","1     304\n","2     202\n","Name: label, dtype: int64\n","target\n","0    2003\n","1     367\n","2      25\n","3       5\n","Name: target, dtype: int64\n","aggr\n","0    1799\n","1     533\n","2      68\n","Name: aggr, dtype: int64\n"]}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"O_yQvaFokn5B","executionInfo":{"status":"ok","timestamp":1630903714138,"user_tz":420,"elapsed":11,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"3085843b-d819-4fe1-c1b5-685ff8fd6602"},"source":["from collections import Counter\n","\n","Counter(train_dt.label)"],"execution_count":11,"outputs":[{"output_type":"execute_result","data":{"text/plain":["Counter({0: 1894, 1: 304, 2: 202})"]},"metadata":{},"execution_count":11}]},{"cell_type":"code","metadata":{"id":"dJ7PFVKhT_2S","executionInfo":{"status":"ok","timestamp":1630903714292,"user_tz":420,"elapsed":159,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["def calculate_class_weights(d, varlist:list):\n","    \"\"\"\n","    Calculate class weights based on formula found on https://www.analyticsvidhya.com/blog/2020/10/improve-class-imbalance-class-weights/\n","    param d: dataframe, statitiss are calculated on d \n","    param varlist: list of variable names in string\n","    \"\"\"\n","    n_samples = d.shape[0]\n","    weight_dict = dict()\n","    for v in varlist:\n","        count_dict = Counter(d[v])\n","        count_dict = {k: count_dict[k] for k in sorted(count_dict.keys()) }\n","        n_classes = d[v].nunique()\n","        weight_dict[v] = {k: round(n_samples/(n_classes * count_dict[k]),2) for k in count_dict}\n","\n","    return weight_dict"],"execution_count":12,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"uHhynT4cnTi2","executionInfo":{"status":"ok","timestamp":1630903714292,"user_tz":420,"elapsed":7,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"f8e656a9-c1ee-4d55-ddb7-acab8773254b"},"source":["calculate_class_weights(train_dt, ['label', 'target', 'aggr'])"],"execution_count":13,"outputs":[{"output_type":"execute_result","data":{"text/plain":["{'aggr': {0: 0.44, 1: 1.5, 2: 11.76},\n"," 'label': {0: 0.42, 1: 2.63, 2: 3.96},\n"," 'target': {0: 0.3, 1: 1.63, 2: 24.0, 3: 120.0}}"]},"metadata":{},"execution_count":13}]},{"cell_type":"markdown","metadata":{"id":"42nIFpyRNTJw"},"source":["## Tokenize state"]},{"cell_type":"code","metadata":{"id":"GPIccBVB_yr1","colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"status":"ok","timestamp":1630903714480,"user_tz":420,"elapsed":191,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"ad197458-9771-4dab-8457-ebe9e5f7865f"},"source":["# import hashtag_dict \n","HASHTAG_DIR = '/content/drive/MyDrive/Colab Notebooks/Bert Hate Speech/utils/' \n","with open(HASHTAG_DIR + 'hashtag_dict.json', 'r') as f:\n","    hashtag_dict = json.load(f)\n","\n","# CUDA is memory hungry. Needs to reduce the max_len\n","MAX_LEN = 225\n","print(\"Maximum length of cleaned up dataset is:\", MAX_LEN)"],"execution_count":14,"outputs":[{"output_type":"stream","name":"stdout","text":["Maximum length of cleaned up dataset is: 225\n"]}]},{"cell_type":"code","metadata":{"id":"CIPViSOuXhTA","colab":{"base_uri":"https://localhost:8080/","height":145,"referenced_widgets":["92f485d689a54f32a67277363bd41b8d","7b7ac68a999c4724b8a2a4f3a7624846","449c108e50584aaa803326fe15da8eb8","d55bf49125cd40069416f088d9fd0500","61fed412fdaf4b3faff81dc270489e82","6fe0c2925d49474e85ce997023dfb6aa","643a8749580c41609823e31618e27f14","1ae1a0a09be04039acc70988aa00d42e","f9e8d3441ece4e088dc1f1b3f644bb5d","daa855e844054270947ce5bd708e8f29","756e025b13b04015b89eef646ff00547","91e31d2256734d02be240743664f7781","bb800195017345f4a1d78b3865ad67c8","692ccbaf27444d908177a723047bdb14","46a0319453cb4d1f90398fedc12bd206","b19e82a2f6554fcd9fb46f2e224be009","12d23a326f424597b00d8136511d944a","cdea212730f24996bab5d83c09d772f2","9f87e9bff001439f8be84e0fca076c87","d15470c7627946a8a19d9ef4177f6fca","5fbbd99832104a86b2829cf75644659d","7104ac69b1b44268ad65673ea7d54a69","18c516bcdf9b41a397d6e4e2b5cfee8f","9c3d229cb76f4f3ca509aa3dde862fc6","5ba6e8ce844b4332b96dab214d80cfa4","0fdf544c202047de981acf72dcc48718","31ab7c2d44864da995f29978d6c0cf5a","d7e8c3a6049a4e419f42f33d2d3d5f98","1fe5b3eab12742d9921943af0f290a76","e7c22bf60cda49e482cffc5067b2813f","1008ec0c6e5d487f90bf219887ea7ed8","3e064070a7524220bdc7f23b716762ca","0d17c4916f29474f931024216ebfa368","3a3257d9f49944dfad978b6962dd9b20","1a5319316a2f411ea920fc04aa6605f0","a1ea84ad97d54d72992c79adfedaa009","9714fab78c704c98afc8f688af031cce","80bd1d9b5129488cabe9c4e290d62ac6","f7a4d9739b09445992c6e8a182584081","e0a080d5e13b4f97bf7ac18bebeba08d","7b371e84218043f1b7c72c21f7d6b7ee","7da5b43ddd8c4ab2803dacf80c8ed978","03f0e29f66d24b00adc2f038df15891e","68953f90bbe14285a00379e145c33f54"]},"executionInfo":{"status":"ok","timestamp":1630903717134,"user_tz":420,"elapsed":2656,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"7cfd5d43-7a69-45f5-bb7a-8aa289a214de"},"source":["tokenizer = RobertaTokenizer.from_pretrained(\"roberta-base\")"],"execution_count":15,"outputs":[{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"92f485d689a54f32a67277363bd41b8d","version_minor":0,"version_major":2},"text/plain":["Downloading:   0%|          | 0.00/899k [00:00<?, ?B/s]"]},"metadata":{}},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"91e31d2256734d02be240743664f7781","version_minor":0,"version_major":2},"text/plain":["Downloading:   0%|          | 0.00/456k [00:00<?, ?B/s]"]},"metadata":{}},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"18c516bcdf9b41a397d6e4e2b5cfee8f","version_minor":0,"version_major":2},"text/plain":["Downloading:   0%|          | 0.00/1.36M [00:00<?, ?B/s]"]},"metadata":{}},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"3a3257d9f49944dfad978b6962dd9b20","version_minor":0,"version_major":2},"text/plain":["Downloading:   0%|          | 0.00/481 [00:00<?, ?B/s]"]},"metadata":{}}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"HP_qSMkuohrO","executionInfo":{"status":"ok","timestamp":1630903719349,"user_tz":420,"elapsed":2220,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"54fe27c8-39c7-4bd8-e92b-6dc765e22129"},"source":["train_input_ids, train_attn_masks  = tokenizing(train_dt.text.values, tokenizer, MAX_LEN)\n","test_input_ids, test_attn_masks  = tokenizing(test_dt.text.values, tokenizer, MAX_LEN)"],"execution_count":16,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/transformers/tokenization_utils_base.py:2204: FutureWarning: The `pad_to_max_length` argument is deprecated and will be removed in a future version, use `padding=True` or `padding='longest'` to pad to the longest sequence in the batch, or use `padding='max_length'` to pad to a max length. In this case, you can give a specific length with `max_length` (e.g. `max_length=45`) or leave max_length to None to pad to the maximal input size of the model (e.g. 512 for Bert).\n","  FutureWarning,\n"]},{"output_type":"stream","name":"stdout","text":["Total time taken:  1.7439260482788086\n","Total time taken:  0.3957343101501465\n"]}]},{"cell_type":"code","metadata":{"id":"Z8GXNGVITNnp","executionInfo":{"status":"ok","timestamp":1630903719351,"user_tz":420,"elapsed":8,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["def arrange_tensor(dt, input_ids, attn_masks, varlist:list): \n","    \"\"\"\n","    Return the tensorset that inclueds all the target values \n","    param dt: dataframe \n","    param input_ids: tensor of input_ids from tokenizer\n","    param attn_masks: tensor of attention masks from tokenizer\n","    param varlist: list of variable names in string\n","    \"\"\"\n","    dt_labels = [dt[v].values for v in varlist ]\n","    dt_tensor = prepare_tensorset(input_ids, attn_masks, dt_labels)\n","    return dt_labels, dt_tensor "],"execution_count":17,"outputs":[]},{"cell_type":"code","metadata":{"id":"5UaN8FNEUbn9","executionInfo":{"status":"ok","timestamp":1630903719535,"user_tz":420,"elapsed":191,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["varlist = ['label', 'target', 'aggr']\n","_, train_tensor = arrange_tensor(train_dt, train_input_ids, train_attn_masks ,varlist=varlist)\n","_, test_tensor  = arrange_tensor(test_dt, test_input_ids, test_attn_masks ,varlist=varlist)"],"execution_count":18,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"8RNJyuEsVfCB","executionInfo":{"status":"ok","timestamp":1630903719764,"user_tz":420,"elapsed":231,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"7c63bda5-43fe-4821-b576-a88d5a2612b2"},"source":["test_tensor[:][-1].shape"],"execution_count":19,"outputs":[{"output_type":"execute_result","data":{"text/plain":["torch.Size([600])"]},"metadata":{},"execution_count":19}]},{"cell_type":"markdown","metadata":{"id":"jKEuQnyKzKaP"},"source":["# BUILD MODEL"]},{"cell_type":"markdown","metadata":{"id":"ptpLoOHEKWBx"},"source":["In this model, we will build an LSTM model leveraging BERT base hidden data on top. The key difference compared to simpleBert is that we need to save the parameters."]},{"cell_type":"code","metadata":{"id":"t0NtCmP8NM8B","executionInfo":{"status":"ok","timestamp":1630903719765,"user_tz":420,"elapsed":6,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["SAVE_PATH = \"/content/drive/My Drive/Colab Notebooks/Bert Hate Speech/Saved Parameters/\"\n","\n","vidgen_weights = \"/content/drive/My Drive/Colab Notebooks/Bert Hate Speech/Saved Parameters/Vidgen/Roberta_NN_09_03_21_0735.pth\""],"execution_count":20,"outputs":[]},{"cell_type":"code","metadata":{"id":"2K9sRD_qgCEY","executionInfo":{"status":"ok","timestamp":1630903719765,"user_tz":420,"elapsed":5,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["def run_models(save_path:str, model_class, num_labels, num_tasks, num_epochs, loss_funcs:list, device,\n","        train_tensor, test_tensor, val_tensor=None, batch_size=20, label_ls = [[0,1,2]],\n","         seed_list = [101,211,307,401,503], save_seed=0):\n","\n","    final_metrics = dict()\n","    # Iterate through seeds\n","    for idx, s in enumerate(seed_list):\n","        print('========== Trying seed', s, '==========')\n","        # Reset the seed\n","        seed = s\n","        random.seed(seed)\n","        os.environ['PYTHONHASHSEED'] = str(seed)\n","        np.random.seed(seed)\n","        torch.manual_seed(seed)\n","        torch.cuda.manual_seed(seed)\n","        torch.backends.cudnn.deterministic = True\n","        torch.backends.cudnn.benchmark = True\n","    \n","        # print(\"Random num: \", random.randint(1,1000))\n","        \n","        gc.collect()\n","        torch.cuda.empty_cache()\n","\n","        # Initialize model\n","        model = model_class('roberta-base', num_labels=num_labels, max_len=MAX_LEN)\n","        optimizer = AdamW(model.parameters(),lr=2e-5, eps=1e-6, weight_decay=1e-3)\n","        build_params = {'device':device, 'optimizer': optimizer, 'loss_functions': loss_funcs}\n","        # build \n","        model.build(**build_params)\n","\n","        # train\n","        if val_tensor is None:\n","            model.train(train_tensor, batch_size = batch_size,\n","                        num_epochs=num_epochs, verbose=True)\n","        else: \n","            model.train(train_tensor, val_tensor=val_tensor, batch_size=batch_size,\n","                        num_epochs=num_epochs, verbose=True)\n","\n","        # evaluate\n","        _, logits, labels = model.evaluate(test_tensor)\n","        logits, labels = format_outputs(logits, labels, num_tasks)\n","        preds = get_labels_from_multi_logits(logits)\n","        res = print_report_multitask(labels, preds, label_ls )\n","\n","        final_metrics[s] = res\n","\n","        if idx==save_seed:\n","            model.save(save_path)\n","        del model\n","\n","    return final_metrics "],"execution_count":21,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000,"referenced_widgets":["78a5d4635ab340b38ce8918c79568bcc","36f7925836514c56b42837136b2a9e69","97f1f68d4d9a481a8570250efcfae485","58759061d8534e2ab2a6ca8bad3e10ec","d8922b85d67946d2a1a847fb7f39b632","423166a905b74a98a00b22384fb76412","838ff370257a49a9aa0a1634c9ef7d7b","7e3562b0ff974250b46250208248447d","18a7e0142abb46bda8df6aac01d148c5","5f658c1898bb479786227d3667a47f68","60d8d574da0a423d8a759411b4f86f34"]},"id":"_iTm811coQuf","executionInfo":{"status":"ok","timestamp":1630904131861,"user_tz":420,"elapsed":412100,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"3dc83ffc-97b3-41d9-917f-97c5c42700cc"},"source":["target_ls = ['label','target','aggr']\n","num_labels =  [3,4,3]\n","num_tasks = len(num_labels)\n","label_ls = [[0,1,2],[0,1,2,3],[0,1,2]]\n","num_epochs = 1\n","# change correct weights\n","weight_dict = calculate_class_weights(train_dt, target_ls)\n","weight_ls  = [list(weight_dict[k].values()) for k in target_ls]\n","loss_funcs = [CrossEntropyLoss(weight=torch.tensor(w).to(device)) for w in weight_ls]\n","\n","model_params = {'num_labels':num_labels, 'num_tasks':num_tasks, 'label_ls':label_ls,\n","                'num_epochs':num_epochs, 'loss_funcs':loss_funcs,\n","                }\n","\n","results = run_models(save_path = SAVE_PATH, model_class= RobertaNN, device=device, \n","     train_tensor=train_tensor, test_tensor=test_tensor, \n","     seed_list=[101,211],\n","      **model_params )"],"execution_count":22,"outputs":[{"output_type":"stream","name":"stdout","text":["========== Trying seed 101 ==========\n","Multitask training: 3 tasks \n"]},{"output_type":"display_data","data":{"application/vnd.jupyter.widget-view+json":{"model_id":"78a5d4635ab340b38ce8918c79568bcc","version_minor":0,"version_major":2},"text/plain":["Downloading:   0%|          | 0.00/501M [00:00<?, ?B/s]"]},"metadata":{}},{"output_type":"stream","name":"stderr","text":["Some weights of the model checkpoint at roberta-base were not used when initializing RobertaModel: ['lm_head.layer_norm.bias', 'lm_head.dense.bias', 'lm_head.layer_norm.weight', 'lm_head.decoder.weight', 'lm_head.bias', 'lm_head.dense.weight']\n","- This IS expected if you are initializing RobertaModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing RobertaModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n"]},{"output_type":"stream","name":"stdout","text":["Multitask training: 3 tasks \n"]},{"output_type":"stream","name":"stderr","text":["Some weights of the model checkpoint at roberta-base were not used when initializing RobertaModel: ['lm_head.layer_norm.bias', 'lm_head.dense.bias', 'lm_head.layer_norm.weight', 'lm_head.decoder.weight', 'lm_head.bias', 'lm_head.dense.weight']\n","- This IS expected if you are initializing RobertaModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing RobertaModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n"]},{"output_type":"stream","name":"stdout","text":["Running Epoch  0\n","Training loss : [115.62932807207108, 123.73559954762459, 117.33536294102669]. Validation loss: []. Duration: 172.50227689743042\n","num_tasks 3\n","\n","-----Report for task 0:-----\n","\n","precision: [0.99082569 0.2745098  0.33333333]\n","recall   : [0.66804124 0.71794872 0.62162162]\n","fscore   : [0.79802956 0.39716312 0.43396226]\n","support  : [485  78  37]\n","\n","-----Report for task 1:-----\n","\n","precision: [0.98356164 0.4969697  0.1        0.        ]\n","recall   : [0.71513944 0.94252874 0.7        0.        ]\n","fscore   : [0.82814302 0.65079365 0.175      0.        ]\n","support  : [502  87  10   1]\n","\n","-----Report for task 2:-----\n","\n","precision: [0.93557423 0.41843972 0.15686275]\n","recall   : [0.75565611 0.42753623 0.8       ]\n","fscore   : [0.83604506 0.42293907 0.26229508]\n","support  : [442 138  20]\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/sklearn/metrics/_classification.py:1272: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.\n","  _warn_prf(average, modifier, msg_start, len(result))\n"]},{"output_type":"stream","name":"stdout","text":["========== Trying seed 211 ==========\n","Multitask training: 3 tasks \n"]},{"output_type":"stream","name":"stderr","text":["Some weights of the model checkpoint at roberta-base were not used when initializing RobertaModel: ['lm_head.layer_norm.bias', 'lm_head.dense.bias', 'lm_head.layer_norm.weight', 'lm_head.decoder.weight', 'lm_head.bias', 'lm_head.dense.weight']\n","- This IS expected if you are initializing RobertaModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing RobertaModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n"]},{"output_type":"stream","name":"stdout","text":["Multitask training: 3 tasks \n"]},{"output_type":"stream","name":"stderr","text":["Some weights of the model checkpoint at roberta-base were not used when initializing RobertaModel: ['lm_head.layer_norm.bias', 'lm_head.dense.bias', 'lm_head.layer_norm.weight', 'lm_head.decoder.weight', 'lm_head.bias', 'lm_head.dense.weight']\n","- This IS expected if you are initializing RobertaModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing RobertaModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n"]},{"output_type":"stream","name":"stdout","text":["Running Epoch  0\n","Training loss : [115.01587373018265, 116.15039677917957, 117.75412231683731]. Validation loss: []. Duration: 174.05213141441345\n","num_tasks 3\n","\n","-----Report for task 0:-----\n","\n","precision: [0.98586572 0.17889908 0.27272727]\n","recall   : [0.57525773 0.5        0.72972973]\n","fscore   : [0.7265625  0.26351351 0.39705882]\n","support  : [485  78  37]\n","\n","-----Report for task 1:-----\n","\n","precision: [0.9845679  0.4640884  0.07368421 0.        ]\n","recall   : [0.63545817 0.96551724 0.7        0.        ]\n","fscore   : [0.77239709 0.62686567 0.13333333 0.        ]\n","support  : [502  87  10   1]\n","\n","-----Report for task 2:-----\n","\n","precision: [0.94318182 0.33333333 0.1043956 ]\n","recall   : [0.75113122 0.15942029 0.95      ]\n","fscore   : [0.83627204 0.21568627 0.18811881]\n","support  : [442 138  20]\n"]}]},{"cell_type":"markdown","metadata":{"id":"p_XHkdZQ4Opy"},"source":["## STEP BY STEP PROCESS DATA"]},{"cell_type":"markdown","metadata":{"id":"kOc7AxXx-ZPK"},"source":["### SPECIFIC METRICS"]},{"cell_type":"code","metadata":{"id":"HPpGBDuFRMcl","executionInfo":{"status":"ok","timestamp":1630904131862,"user_tz":420,"elapsed":27,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["## process line by line \n","res = list(results.values())"],"execution_count":23,"outputs":[]},{"cell_type":"code","metadata":{"id":"M3V4slhXyCB_","executionInfo":{"status":"ok","timestamp":1630904131862,"user_tz":420,"elapsed":24,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["task_no = 1\n","x = np.array([r[task_no]['full_metrics'][:-1] for r in res])"],"execution_count":24,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"p2YfHrKj11e9","executionInfo":{"status":"ok","timestamp":1630904131863,"user_tz":420,"elapsed":25,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"618ab34d-e3e4-4466-8d97-e6b44aa245d7"},"source":["x"],"execution_count":25,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([[[0.98356164, 0.4969697 , 0.1       , 0.        ],\n","        [0.71513944, 0.94252874, 0.7       , 0.        ],\n","        [0.82814302, 0.65079365, 0.175     , 0.        ]],\n","\n","       [[0.9845679 , 0.4640884 , 0.07368421, 0.        ],\n","        [0.63545817, 0.96551724, 0.7       , 0.        ],\n","        [0.77239709, 0.62686567, 0.13333333, 0.        ]]])"]},"metadata":{},"execution_count":25}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"OJ1Fx2JX2aMY","executionInfo":{"status":"ok","timestamp":1630904132025,"user_tz":420,"elapsed":182,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"928952b8-0374-455d-9ad7-ddc1b73d264f"},"source":["## detour, calculting macro precisons recall for task 1 identify target f\n","x1 = x[:,:2,:2]\n","x1"],"execution_count":26,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([[[0.98356164, 0.4969697 ],\n","        [0.71513944, 0.94252874]],\n","\n","       [[0.9845679 , 0.4640884 ],\n","        [0.63545817, 0.96551724]]])"]},"metadata":{},"execution_count":26}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"JV6r_o8T3WwH","executionInfo":{"status":"ok","timestamp":1630904132026,"user_tz":420,"elapsed":15,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"6853d965-a306-4a4f-ffb9-f7032fd97090"},"source":["np.mean(x1,axis=2)"],"execution_count":27,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([[0.74026567, 0.82883409],\n","       [0.72432815, 0.8004877 ]])"]},"metadata":{},"execution_count":27}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":142},"id":"ovLeP24y3fKF","executionInfo":{"status":"ok","timestamp":1630904132027,"user_tz":420,"elapsed":11,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"a8222be5-0cfd-4f46-a0a3-9746bdb73fb1"},"source":["# take average across each side \n","m = pd.DataFrame(np.mean(x, axis=0))\n","m"],"execution_count":28,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>0</th>\n","      <th>1</th>\n","      <th>2</th>\n","      <th>3</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0.984065</td>\n","      <td>0.480529</td>\n","      <td>0.086842</td>\n","      <td>0.0</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>0.675299</td>\n","      <td>0.954023</td>\n","      <td>0.700000</td>\n","      <td>0.0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>0.800270</td>\n","      <td>0.638830</td>\n","      <td>0.154167</td>\n","      <td>0.0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["          0         1         2    3\n","0  0.984065  0.480529  0.086842  0.0\n","1  0.675299  0.954023  0.700000  0.0\n","2  0.800270  0.638830  0.154167  0.0"]},"metadata":{},"execution_count":28}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":142},"id":"UFr6EPBw42Wu","executionInfo":{"status":"ok","timestamp":1630904132173,"user_tz":420,"elapsed":154,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"899f4a65-3521-4d0d-94ac-69901ee815f3"},"source":["std = pd.DataFrame(np.round(np.std(x, axis=0),2))\n","std"],"execution_count":29,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>0</th>\n","      <th>1</th>\n","      <th>2</th>\n","      <th>3</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0.00</td>\n","      <td>0.02</td>\n","      <td>0.01</td>\n","      <td>0.0</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>0.04</td>\n","      <td>0.01</td>\n","      <td>0.00</td>\n","      <td>0.0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>0.03</td>\n","      <td>0.01</td>\n","      <td>0.02</td>\n","      <td>0.0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["      0     1     2    3\n","0  0.00  0.02  0.01  0.0\n","1  0.04  0.01  0.00  0.0\n","2  0.03  0.01  0.02  0.0"]},"metadata":{},"execution_count":29}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"j-wcOJqIBSu2","executionInfo":{"status":"ok","timestamp":1630904132174,"user_tz":420,"elapsed":8,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"eb2e3e81-8d1e-4e2d-9290-0f5dda26a25c"},"source":["m.iloc[0].map(str) + ' +- ' +  std.iloc[0].map(str)"],"execution_count":30,"outputs":[{"output_type":"execute_result","data":{"text/plain":["0      0.9840647725350922 +- 0.0\n","1     0.4805290473798761 +- 0.02\n","2    0.08684210526315789 +- 0.01\n","3                     0.0 +- 0.0\n","Name: 0, dtype: object"]},"metadata":{},"execution_count":30}]},{"cell_type":"code","metadata":{"id":"kEb3mSZ_3uvr","executionInfo":{"status":"ok","timestamp":1630904396360,"user_tz":420,"elapsed":157,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["def get_specific_results(rfull:dict, task_no = 3, verbose=False, \n","                         columns = ['Normal','Abusive','Hate',\n","                                    'Neither/NA','Anti-Asian','Anti-Black','Both',\n","                                    'No.Agg.', 'Some.Agg.','Very.Agg.']):\n","    \"\"\"\n","    Return the final report in horizontal format for the model for \n","    SPECIFIC OUTPUTs.\n","    param rfull: dict from the run models for all the seeds \n","    param task_no: number of tasks the model was trained on\n","    param verbose: bool whether to print out inter. output\n","    \"\"\"\n","    # Iterate through each task\n","    res = list(rfull.values())\n","    mean_ls = []\n","    std_ls = []\n","    for i in range(task_no):\n","        # dont include raw counts\n","        x = np.array([r[i]['full_metrics'][:-1] for r in res])\n","        x_mean = np.mean(x, axis=0)\n","        x_std  = np.std(x, axis=0)\n","        if verbose: \n","            print(\"Task\", i)\n","            print(\"x\\n\",x)\n","            print(\"x_mean\\n\",x_mean)\n","            print(\"x_std\\n\",x_std)\n","        mean_ls.append(x_mean)\n","        std_ls.append(x_std)\n","    \n","    # create df and convert to string\n","    mean_df = pd.DataFrame(np.concatenate(mean_ls, axis=1), columns=columns).round(2).applymap(str)\n","    std_df  = pd.DataFrame(np.concatenate(std_ls, axis=1), columns=columns).round(2).applymap(str)\n","    # concat cell wise\n","    output_df = mean_df + ' +- ' + std_df\n","    # replace 0.0 with -\n","    output_df = output_df.replace('0.0 +- 0.0','--')\n","    return output_df"],"execution_count":52,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ywGcCPug44zI","executionInfo":{"status":"ok","timestamp":1630904397401,"user_tz":420,"elapsed":168,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"1f27361a-5ee6-4363-9507-4202608dd6bc"},"source":["output_df = get_specific_results(results, verbose=True)"],"execution_count":53,"outputs":[{"output_type":"stream","name":"stdout","text":["Task 0\n","x\n"," [[[0.99082569 0.2745098  0.33333333]\n","  [0.66804124 0.71794872 0.62162162]\n","  [0.79802956 0.39716312 0.43396226]]\n","\n"," [[0.98586572 0.17889908 0.27272727]\n","  [0.57525773 0.5        0.72972973]\n","  [0.7265625  0.26351351 0.39705882]]]\n","x_mean\n"," [[0.98834571 0.22670444 0.3030303 ]\n"," [0.62164948 0.60897436 0.67567568]\n"," [0.76229603 0.33033832 0.41551054]]\n","x_std\n"," [[0.00247998 0.04780536 0.03030303]\n"," [0.04639175 0.10897436 0.05405405]\n"," [0.03573353 0.0668248  0.01845172]]\n","Task 1\n","x\n"," [[[0.98356164 0.4969697  0.1        0.        ]\n","  [0.71513944 0.94252874 0.7        0.        ]\n","  [0.82814302 0.65079365 0.175      0.        ]]\n","\n"," [[0.9845679  0.4640884  0.07368421 0.        ]\n","  [0.63545817 0.96551724 0.7        0.        ]\n","  [0.77239709 0.62686567 0.13333333 0.        ]]]\n","x_mean\n"," [[0.98406477 0.48052905 0.08684211 0.        ]\n"," [0.6752988  0.95402299 0.7        0.        ]\n"," [0.80027006 0.63882966 0.15416667 0.        ]]\n","x_std\n"," [[0.00050313 0.01644065 0.01315789 0.        ]\n"," [0.03984064 0.01149425 0.         0.        ]\n"," [0.02787296 0.01196399 0.02083333 0.        ]]\n","Task 2\n","x\n"," [[[0.93557423 0.41843972 0.15686275]\n","  [0.75565611 0.42753623 0.8       ]\n","  [0.83604506 0.42293907 0.26229508]]\n","\n"," [[0.94318182 0.33333333 0.1043956 ]\n","  [0.75113122 0.15942029 0.95      ]\n","  [0.83627204 0.21568627 0.18811881]]]\n","x_mean\n"," [[0.93937802 0.37588652 0.13062917]\n"," [0.75339367 0.29347826 0.875     ]\n"," [0.83615855 0.31931267 0.22520695]]\n","x_std\n"," [[3.80379424e-03 4.25531915e-02 2.62335704e-02]\n"," [2.26244344e-03 1.34057971e-01 7.50000000e-02]\n"," [1.13491991e-04 1.03626397e-01 3.70881350e-02]]\n"]}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":142},"id":"LQ8fuO1K9n1_","executionInfo":{"status":"ok","timestamp":1630904132451,"user_tz":420,"elapsed":7,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"ea31700b-b129-4fbe-d41e-c8eea7129f13"},"source":["output_df"],"execution_count":33,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>Normal</th>\n","      <th>Abusive</th>\n","      <th>Hate</th>\n","      <th>Neither/NA</th>\n","      <th>Anti-Asian</th>\n","      <th>Anti-Black</th>\n","      <th>Both</th>\n","      <th>No.Agg.</th>\n","      <th>Some.Agg.</th>\n","      <th>Very.Agg.</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0.99 +- 0.0</td>\n","      <td>0.23 +- 0.05</td>\n","      <td>0.3 +- 0.03</td>\n","      <td>0.98 +- 0.0</td>\n","      <td>0.48 +- 0.02</td>\n","      <td>0.09 +- 0.01</td>\n","      <td>--</td>\n","      <td>0.94 +- 0.0</td>\n","      <td>0.38 +- 0.04</td>\n","      <td>0.13 +- 0.03</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>0.62 +- 0.05</td>\n","      <td>0.61 +- 0.11</td>\n","      <td>0.68 +- 0.05</td>\n","      <td>0.68 +- 0.04</td>\n","      <td>0.95 +- 0.01</td>\n","      <td>0.7 +- 0.0</td>\n","      <td>--</td>\n","      <td>0.75 +- 0.0</td>\n","      <td>0.29 +- 0.13</td>\n","      <td>0.88 +- 0.07</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>0.76 +- 0.04</td>\n","      <td>0.33 +- 0.07</td>\n","      <td>0.42 +- 0.02</td>\n","      <td>0.8 +- 0.03</td>\n","      <td>0.64 +- 0.01</td>\n","      <td>0.15 +- 0.02</td>\n","      <td>--</td>\n","      <td>0.84 +- 0.0</td>\n","      <td>0.32 +- 0.1</td>\n","      <td>0.23 +- 0.04</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["         Normal       Abusive  ...     Some.Agg.     Very.Agg.\n","0   0.99 +- 0.0  0.23 +- 0.05  ...  0.38 +- 0.04  0.13 +- 0.03\n","1  0.62 +- 0.05  0.61 +- 0.11  ...  0.29 +- 0.13  0.88 +- 0.07\n","2  0.76 +- 0.04  0.33 +- 0.07  ...   0.32 +- 0.1  0.23 +- 0.04\n","\n","[3 rows x 10 columns]"]},"metadata":{},"execution_count":33}]},{"cell_type":"code","metadata":{"id":"-h8QkHHcGoih","executionInfo":{"status":"ok","timestamp":1630904132591,"user_tz":420,"elapsed":7,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["# print(output_df.to_latex(index=False))"],"execution_count":34,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"uTPg8LzaIaK0"},"source":["## PROCESS MACRO METRICS\n","Note: Macro F1s are supposed to be processed based on macro P and F "]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"vb-S5c2sL28x","executionInfo":{"status":"ok","timestamp":1630904132592,"user_tz":420,"elapsed":7,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"858b7feb-2dbb-4c9a-e37d-88980af0dce0"},"source":["task_no = 0\n","y = np.array([r[task_no]['macro_metrics'][:-1] for r in res])\n","y"],"execution_count":35,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([[0.53288961, 0.66920386],\n","       [0.47916403, 0.60166249]])"]},"metadata":{},"execution_count":35}]},{"cell_type":"code","metadata":{"id":"TFb_p8eknGXO","executionInfo":{"status":"ok","timestamp":1630905202987,"user_tz":420,"elapsed":139,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["def calculate_f1(a):\n","    p = a[0]\n","    r = a[1]\n","    if p+r == 0:\n","        return 0.\n","    return (2*p*r)/(p+r)"],"execution_count":54,"outputs":[]},{"cell_type":"code","metadata":{"id":"xz9uq76zqceV","executionInfo":{"status":"ok","timestamp":1630905203757,"user_tz":420,"elapsed":144,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["f = np.apply_along_axis(calculate_f1, 1, y)\n"],"execution_count":55,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"EfoVCvNknSmV","executionInfo":{"status":"ok","timestamp":1630905204571,"user_tz":420,"elapsed":201,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"be1c9394-56c9-4619-e3c9-0466c925623f"},"source":["np.column_stack((y,f))"],"execution_count":56,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([[0.53288961, 0.66920386, 0.59331789],\n","       [0.47916403, 0.60166249, 0.53347141]])"]},"metadata":{},"execution_count":56}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"oPb5WiQfudch","executionInfo":{"status":"ok","timestamp":1630905205919,"user_tz":420,"elapsed":5,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"75e66e55-1590-4890-cdab-376d0b14e6ea"},"source":["results"],"execution_count":57,"outputs":[{"output_type":"execute_result","data":{"text/plain":["{101: [{'full_metrics': [[0.9908256880733946,\n","     0.27450980392156865,\n","     0.3333333333333333],\n","    [0.668041237113402, 0.717948717948718, 0.6216216216216216],\n","    [0.7980295566502462, 0.3971631205673759, 0.43396226415094336],\n","    [485, 78, 37]],\n","   'macro_metrics': [0.5328896084427656,\n","    0.6692038588945805,\n","    0.5430516471228551]},\n","  {'full_metrics': [[0.9835616438356164, 0.49696969696969695, 0.1, 0.0],\n","    [0.7151394422310757, 0.9425287356321839, 0.7, 0.0],\n","    [0.8281430219146483, 0.6507936507936507, 0.175, 0.0],\n","    [502, 87, 10, 1]],\n","   'macro_metrics': [0.39513283520132836,\n","    0.5894170444658149,\n","    0.41348416817707473]},\n","  {'full_metrics': [[0.9355742296918768,\n","     0.41843971631205673,\n","     0.1568627450980392],\n","    [0.755656108597285, 0.427536231884058, 0.8],\n","    [0.8360450563204005, 0.4229390681003585, 0.2622950819672131],\n","    [442, 138, 20]],\n","   'macro_metrics': [0.5036255637006576,\n","    0.661064113493781,\n","    0.5070930687959906]}],\n"," 211: [{'full_metrics': [[0.9858657243816255,\n","     0.17889908256880735,\n","     0.2727272727272727],\n","    [0.5752577319587628, 0.5, 0.7297297297297297],\n","    [0.7265624999999999, 0.2635135135135135, 0.3970588235294118],\n","    [485, 78, 37]],\n","   'macro_metrics': [0.4791640265592352,\n","    0.6016624872294974,\n","    0.46237827901430845]},\n","  {'full_metrics': [[0.9845679012345679,\n","     0.46408839779005523,\n","     0.07368421052631578,\n","     0.0],\n","    [0.6354581673306773, 0.9655172413793104, 0.7, 0.0],\n","    [0.7723970944309928, 0.6268656716417911, 0.1333333333333333, 0.0],\n","    [502, 87, 10, 1]],\n","   'macro_metrics': [0.38058512738773476,\n","    0.575243852177497,\n","    0.3831490248515293]},\n","  {'full_metrics': [[0.9431818181818182,\n","     0.3333333333333333,\n","     0.1043956043956044],\n","    [0.751131221719457, 0.15942028985507245, 0.95],\n","    [0.8362720403022669, 0.2156862745098039, 0.1881188118811881],\n","    [442, 138, 20]],\n","   'macro_metrics': [0.46030358530358534,\n","    0.6201838371915098,\n","    0.41335904223108627]}]}"]},"metadata":{},"execution_count":57}]},{"cell_type":"code","metadata":{"id":"QBJd-M_Ctszw","executionInfo":{"status":"ok","timestamp":1630905207872,"user_tz":420,"elapsed":139,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["def get_macro_results(rfull:dict, task_no = 3, verbose=False):\n","    res = list(rfull.values())\n","    mean_ls = []\n","    std_ls = []\n","    # Iterate through tasks \n","    for i in range(task_no):\n","        num_labels = np.array([r[i]['full_metrics'][:-1] for r in res]).shape[-1]\n","        # Target-tasks only tally Neither and Asian\n","        if num_labels == 4: \n","            x_raw = np.array([r[i]['full_metrics'][:-1] for r in res])\n","            x_raw = x_raw[:,:2,:2]\n","            x = np.mean(x_raw,axis=2)\n","        else:\n","            # calculate f1 separately \n","            x = np.array([r[i]['macro_metrics'][:-1] for r in res])\n","\n","        f = np.apply_along_axis(calculate_f1, 1, x)\n","        x_new = np.column_stack((x,f))\n","        # recalculte mean\n","        x_mean = np.mean(x_new, axis=0)\n","        x_std  = np.std(x_new, axis=0)\n","\n","        mean_ls += x_mean.tolist()\n","        std_ls  += x_std.tolist()\n","        if verbose:\n","                print(\"Task\", i)\n","                print(x)\n","                print(x_new)\n","                print(x_mean)\n","    \n","    # create df and convert to string\n","    mean_df = pd.DataFrame(mean_ls).T.round(2).applymap(str)\n","    std_df  = pd.DataFrame(std_ls).T.round(2).applymap(str)\n","    # concat cell wise\n","    output_df = mean_df + ' +- ' + std_df\n","    # replace 0.0 with -\n","    output_df = output_df.replace('0.0 +- 0.0','--')\n","\n","    return output_df"],"execution_count":58,"outputs":[]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"qUeOvCCDnZjc","executionInfo":{"status":"ok","timestamp":1630905211200,"user_tz":420,"elapsed":136,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"fd20f0b3-69e0-41dc-9027-8a9c84945557"},"source":["o = get_macro_results(results, verbose=True)"],"execution_count":59,"outputs":[{"output_type":"stream","name":"stdout","text":["Task 0\n","[[0.53288961 0.66920386]\n"," [0.47916403 0.60166249]]\n","[[0.53288961 0.66920386 0.59331789]\n"," [0.47916403 0.60166249 0.53347141]]\n","[0.50602682 0.63543317 0.56339465]\n","Task 1\n","[[0.74026567 0.82883409]\n"," [0.72432815 0.8004877 ]]\n","[[0.74026567 0.82883409 0.78205024]\n"," [0.72432815 0.8004877  0.76050597]]\n","[0.73229691 0.8146609  0.7712781 ]\n","Task 2\n","[[0.50362556 0.66106411]\n"," [0.46030359 0.62018384]]\n","[[0.50362556 0.66106411 0.57170385]\n"," [0.46030359 0.62018384 0.52841493]]\n","[0.48196457 0.64062398 0.55005939]\n"]}]},{"cell_type":"code","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":80},"id":"hkSCcrRRs55x","executionInfo":{"status":"ok","timestamp":1630905217466,"user_tz":420,"elapsed":180,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}},"outputId":"e064ac25-b0c3-4966-aa4f-36d865fa9c1b"},"source":["o"],"execution_count":60,"outputs":[{"output_type":"execute_result","data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>0</th>\n","      <th>1</th>\n","      <th>2</th>\n","      <th>3</th>\n","      <th>4</th>\n","      <th>5</th>\n","      <th>6</th>\n","      <th>7</th>\n","      <th>8</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0.51 +- 0.03</td>\n","      <td>0.64 +- 0.03</td>\n","      <td>0.56 +- 0.03</td>\n","      <td>0.73 +- 0.01</td>\n","      <td>0.81 +- 0.01</td>\n","      <td>0.77 +- 0.01</td>\n","      <td>0.48 +- 0.02</td>\n","      <td>0.64 +- 0.02</td>\n","      <td>0.55 +- 0.02</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["              0             1  ...             7             8\n","0  0.51 +- 0.03  0.64 +- 0.03  ...  0.64 +- 0.02  0.55 +- 0.02\n","\n","[1 rows x 9 columns]"]},"metadata":{},"execution_count":60}]},{"cell_type":"code","metadata":{"id":"BJjyHSDGwyY3","executionInfo":{"status":"ok","timestamp":1630904133194,"user_tz":420,"elapsed":8,"user":{"displayName":"Huy Nghiem","photoUrl":"","userId":"06903637911945605583"}}},"source":["## We need to save the outputs for each model in the Results folder."],"execution_count":42,"outputs":[]}]}